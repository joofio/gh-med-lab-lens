{
  "resourceType": "Library",
  "id": "qt-prolongation-lens",
  "meta": {
    "profile": [
      "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lens"
    ]
  },
  "type": {
    "coding": [
      {
        "code": "logical-library"
      }
    ]
  },
  "extension": [
    {
      "url": "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lee-version",
      "valueString": "dev"
    }
  ],
  "url": "http://hl7.eu/fhir/ig/gravitate-health/Library/588",
  "identifier": [
    {
      "system": "http://gravitate-health.lst.tfo.upm.es",
      "value": "qt-prolongation-lens"
    }
  ],
  "version": "0.0.1",
  "name": "QT prolongation lens",
  "_name": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente para la prolongación del QT"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente para o prolongamento do QT"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse til QT-forlængelse"
          }
        ]
      }
    ]
  },
  "title": "qt-prolongation-lens",
  "_title": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente para la prolongación del QT"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente para o prolongamento do QT"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse til QT-forlængelse"
          }
        ]
      }
    ]
  },
  "status": "draft",
  "experimental": true,
  "date": "2026-02-12T15:25:46.213Z",
  "publisher": "Gravitate Health Project - UPM Team",
  "contact": [
    {
      "name": "Gravitate Health",
      "telecom": [
        {
          "system": "url",
          "value": "https://www.gravitatehealth.eu/"
        }
      ]
    }
  ],
  "description": "Lens that highlights QT prolongation risk information when patient is taking Citalopram and has low potassium levels",
  "_description": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente que resalta información sobre el riesgo de prolongación del QT cuando el paciente toma Citalopram y tiene niveles bajos de potasio"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente que destaca informações sobre o risco de prolongamento do QT quando o paciente toma Citalopram e tem níveis baixos de potássio"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse der fremhæver information om QT-forlængelsesrisiko når patienten tager Citalopram og har lavt kaliumniveau"
          }
        ]
      }
    ]
  },
  "jurisdiction": [
    {
      "coding": [
        {
          "code": "EU",
          "system": "urn:iso:std:iso:3166"
        }
      ]
    }
  ],
  "purpose": "Highlight QT prolongation risk information in a preprocessed ePI when patient takes Citalopram and has low potassium (K+ < 3.5 mmol/L).",
  "_purpose": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Resaltar información sobre el riesgo de prolongación del QT en una ePI preprocesada cuando el paciente toma Citalopram y tiene potasio bajo (K+ < 3.5 mmol/L)."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Destacar informações sobre o risco de prolongamento do QT em uma ePI pré-processada quando o paciente toma Citalopram e tem potássio baixo (K+ < 3.5 mmol/L)."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Fremhæv information om QT-forlængelsesrisiko i en forbehandlet ePI når patienten tager Citalopram og har lavt kalium (K+ < 3.5 mmol/L)."
          }
        ]
      }
    ]
  },
  "usage": "You can import this lens directly to your FHIR Server which suports Library Resource type.",
  "_usage": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Puedes importar esta lente directamente a tu servidor FHIR que soporte el tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Podes importar esta lente diretamente para o teu servidor FHIR que suporte o tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Du kan importere denne linse direkte til din FHIR-server, som understøtter ressource-typen Library."
          }
        ]
      }
    ]
  },
  "copyright": "© 2024 Gravitate Health",
  "parameter": [
    {
      "use": "in",
      "documentation": "parameter if it exists",
      "type": "CodeableConcept"
    }
  ],
  "content": [
    {
      "contentType": "application/javascript",
      "title": "Lens for QT prolongation risk",
      "data": "bGV0IGh0bWxEYXRhID0gaHRtbDsKbGV0IGlwc0RhdGEgPSBpcHM7CmxldCBsYW5nID0gIiI7ICAvLyBEZWZhdWx0IGxhbmd1YWdlLCB3aWxsIGJlIHNldCBieSBlUEkKCmxldCBnZXRTcGVjaWZpY2F0aW9uID0gKCkgPT4gewogICAgcmV0dXJuICIxLjAuMCI7Cn07CgpsZXQgYW5ub3RhdGlvblByb2Nlc3MgPSAobGlzdE9mQ2F0ZWdvcmllcywgZW5oYW5jZVRhZywgZG9jdW1lbnQsIHJlc3BvbnNlKSA9PiB7CiAgICBsaXN0T2ZDYXRlZ29yaWVzLmZvckVhY2goKGNoZWNrKSA9PiB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmluY2x1ZGVzKGNoZWNrKSkgewogICAgICAgICAgICBsZXQgZWxlbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNoZWNrKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgZWxlbWVudHNbaV0uY2xhc3NMaXN0LmFkZChlbmhhbmNlVGFnKTsKICAgICAgICAgICAgICAgIGVsZW1lbnRzW2ldLmNsYXNzTGlzdC5hZGQoInF0LXByb2xvbmdhdGlvbi1sZW5zIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIikubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKVswXS5yZW1vdmUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF0uaW5uZXJIVE1MOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlJlc3BvbnNlOiAiICsgcmVzcG9uc2UpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlJlc3BvbnNlOiAiICsgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmlubmVySFRNTCk7CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5pbm5lckhUTUw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKCiAgICBpZiAocmVzcG9uc2UgPT0gbnVsbCB8fCByZXNwb25zZSA9PSAiIikgewogICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICAgIkFubm90YXRpb24gcHJvY2Nlc3MgZmFpbGVkOiBSZXR1cm5lZCBlbXB0eSBvciBudWxsIHJlc3BvbnNlIgogICAgICAgICk7CiAgICAgICAgLy9yZXR1cm4gaHRtbERhdGEKICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5sb2coIlJlc3BvbnNlOiAiICsgcmVzcG9uc2UpOwogICAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0KfQoKCmxldCBhbm5vdGF0ZUhUTUxzZWN0aW9uID0gYXN5bmMgKGxpc3RPZkNhdGVnb3JpZXMsIGVuaGFuY2VUYWcpID0+IHsKICAgIGxldCByZXNwb25zZSA9IGh0bWxEYXRhOwogICAgbGV0IGRvY3VtZW50OwoKICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAidW5kZWZpbmVkIikgewogICAgICAgIGxldCBqc2RvbSA9IGF3YWl0IGltcG9ydCgianNkb20iKTsKICAgICAgICBsZXQgeyBKU0RPTSB9ID0ganNkb207CiAgICAgICAgbGV0IGRvbSA9IG5ldyBKU0RPTShodG1sRGF0YSk7CiAgICAgICAgZG9jdW1lbnQgPSBkb20ud2luZG93LmRvY3VtZW50OwogICAgICAgIHJldHVybiBhbm5vdGF0aW9uUHJvY2VzcyhsaXN0T2ZDYXRlZ29yaWVzLCBlbmhhbmNlVGFnLCBkb2N1bWVudCwgcmVzcG9uc2UpOwogICAgfSBlbHNlIHsKICAgICAgICBkb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudDsKICAgICAgICByZXR1cm4gYW5ub3RhdGlvblByb2Nlc3MobGlzdE9mQ2F0ZWdvcmllcywgZW5oYW5jZVRhZywgZG9jdW1lbnQsIHJlc3BvbnNlKTsKICAgIH0KfTsKCgoKbGV0IGVuaGFuY2UgPSBhc3luYyAoKSA9PiB7CiAgICBpZiAoIWlwc0RhdGEgfHwgIWlwc0RhdGEuZW50cnkgfHwgaXBzRGF0YS5lbnRyeS5sZW5ndGggPT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIklQUyBpcyBlbXB0eSBvciBpbnZhbGlkLiIpOwogICAgfQoKICAgIC8vIDEuIENoZWNrIENvbXBvc2l0aW9uLmxhbmd1YWdlCiAgICBlcGk/LmVudHJ5Py5mb3JFYWNoKChlbnRyeSkgPT4gewogICAgICAgIGNvbnN0IHJlcyA9IGVudHJ5LnJlc291cmNlOwogICAgICAgIGlmIChyZXM/LnJlc291cmNlVHlwZSA9PT0gIkNvbXBvc2l0aW9uIiAmJiByZXMubGFuZ3VhZ2UpIHsKICAgICAgICAgICAgbGFuZyA9IHJlcy5sYW5ndWFnZTsKICAgICAgICAgICAgY29uc29sZS5sb2coIvCfjI0gRGV0ZWN0ZWQgZnJvbSBDb21wb3NpdGlvbi5sYW5ndWFnZToiLCBsYW5nKTsKICAgICAgICB9CiAgICB9KTsKCiAgICAvLyAyLiBJZiBub3QgZm91bmQsIGNoZWNrIEJ1bmRsZS5sYW5ndWFnZQogICAgaWYgKCFsYW5nICYmIGVwaT8ubGFuZ3VhZ2UpIHsKICAgICAgICBsYW5nID0gZXBpLmxhbmd1YWdlOwogICAgICAgIGNvbnNvbGUubG9nKCLwn4yNIERldGVjdGVkIGZyb20gQnVuZGxlLmxhbmd1YWdlOiIsIGxhbmcpOwogICAgfQoKICAgIC8vIDMuIEZhbGxiYWNrCiAgICBpZiAoIWxhbmcpIHsKICAgICAgICBjb25zb2xlLndhcm4oIuKaoO+4jyBObyBsYW5ndWFnZSBkZXRlY3RlZCBpbiBDb21wb3NpdGlvbiBvciBCdW5kbGUuIik7CiAgICAgICAgbGFuZyA9ICJlbiI7CiAgICB9CgogICAgbGV0IGVuaGFuY2VUYWcgPSAiaGlnaGxpZ2h0IjsKICAgIGxldCBsaXN0T2ZDYXRlZ29yaWVzVG9TZWFyY2ggPSBbeyAiY29kZSI6ICJncmF2LTEiLCAic3lzdGVtIjogImh0dHA6Ly9ncmF2aXRhdGUtaGVhbHRoLmV1L2NvZGVzIiB9XTsgLy93aGF0IHRvIGxvb2sgaW4gZXh0ZW5zaW9ucyAtbWFkZSB1cCBjb2RlIGJlY2F1c2UgdGhlcmUgaXMgbm9uZQoKICAgIC8vIEhpZ2hsaWdodCA8UVQgcHJvbG9uZ2F0aW9uIHJpc2s+IElGIE1lZGljYXRpb25SZXF1ZXN0Lm1lZGljYXRpb24gPT0gW0NpdGFsb3ByYW1dIAogICAgLy8gQU5EIE9ic2VydmF0aW9uLmNvZGUgPT0gIksrIiAobG9pbmMgMjgyMy0zKSBBTkQgT2JzZXJ2YXRpb24udmFsdWUgPCAzLjUgbW1vbC9MCgogICAgY29uc3QgcG90YXNzaXVtQ29kZXMgPSBbIjI4MjMtMyIsICI2Mjk4LTQiXTsgLy8gd2hhdCB0byBsb29rIGluIElQUyBMYWIKICAgIGNvbnN0IGNpdGFsb3ByYW1LZXl3b3JkcyA9IFsiY2l0YWxvcHJhbSIsICJDaXRhbG9wcmFtIl07IC8vIHdoYXQgdG8gbG9vayBpbiBtZWRpY2F0aW9uIHJlcXVlc3QgLyBzdGF0ZW1lbnRzCiAgICBjb25zdCBjaXRhbG9wcmFtQ29kZXMgPSBbIjIwNDQ0NyIsICIzNzI3MjkwMDkiXTsvLyB3aGF0IHRvIGxvb2sgaW4gbWVkaWNhdGlvbiByZXF1ZXN0IC8gc3RhdGVtZW50cwoKICAgIGxldCBoYXNMb3dQb3Rhc3NpdW0gPSBmYWxzZTsKICAgIGxldCB0YWtpbmdDaXRhbG9wcmFtID0gZmFsc2U7CgogICAgLy8gSW5kZXggbWVkaWNhdGlvbnMgYnkgcmVmZXJlbmNlIElECiAgICBjb25zdCBtZWRpY2F0aW9uc0J5SWQgPSBuZXcgTWFwKCk7CiAgICBpcHNEYXRhLmVudHJ5LmZvckVhY2goKGVudHJ5KSA9PiB7CiAgICAgICAgaWYgKGVudHJ5LnJlc291cmNlPy5yZXNvdXJjZVR5cGUgPT09ICJNZWRpY2F0aW9uIiAmJiBlbnRyeS5yZXNvdXJjZS5pZCkgewogICAgICAgICAgICBtZWRpY2F0aW9uc0J5SWQuc2V0KGBNZWRpY2F0aW9uLyR7ZW50cnkucmVzb3VyY2UuaWR9YCwgZW50cnkucmVzb3VyY2UpOwogICAgICAgIH0KICAgIH0pOwoKICAgIGZvciAoY29uc3QgZW50cnkgb2YgaXBzRGF0YS5lbnRyeSkgewogICAgICAgIGNvbnN0IHJlcyA9IGVudHJ5LnJlc291cmNlOwogICAgICAgIGlmICghcmVzKSBjb250aW51ZTsKCiAgICAgICAgLy8gQ2hlY2sgcG90YXNzaXVtCiAgICAgICAgaWYgKAogICAgICAgICAgICByZXMucmVzb3VyY2VUeXBlID09PSAiT2JzZXJ2YXRpb24iICYmCiAgICAgICAgICAgIHJlcy5jb2RlPy5jb2RpbmcgJiYKICAgICAgICAgICAgdHlwZW9mIHJlcy52YWx1ZVF1YW50aXR5Py52YWx1ZSA9PT0gIm51bWJlciIKICAgICAgICApIHsKICAgICAgICAgICAgY29uc3QgaXNLID0gcmVzLmNvZGUuY29kaW5nLnNvbWUoCiAgICAgICAgICAgICAgICAoYykgPT4KICAgICAgICAgICAgICAgICAgICBwb3Rhc3NpdW1Db2Rlcy5pbmNsdWRlcyhjLmNvZGUpIHx8CiAgICAgICAgICAgICAgICAgICAgYy5kaXNwbGF5Py50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCJwb3Rhc3NpdW0iKQogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoaXNLICYmIHJlcy52YWx1ZVF1YW50aXR5LnZhbHVlIDwgMy41KSB7CiAgICAgICAgICAgICAgICBoYXNMb3dQb3Rhc3NpdW0gPSB0cnVlOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIuKaoO+4jyBMb3cgSys6IiwgcmVzLnZhbHVlUXVhbnRpdHkudmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBNZWRpY2F0aW9uU3RhdGVtZW50IG9yIE1lZGljYXRpb25SZXF1ZXN0CiAgICAgICAgaWYgKFsiTWVkaWNhdGlvblN0YXRlbWVudCIsICJNZWRpY2F0aW9uUmVxdWVzdCJdLmluY2x1ZGVzKHJlcy5yZXNvdXJjZVR5cGUpKSB7CiAgICAgICAgICAgIGxldCBjb2RlcyA9IFtdOwoKICAgICAgICAgICAgLy8gQ2FzZSAxOiBtZWRpY2F0aW9uQ29kZWFibGVDb25jZXB0CiAgICAgICAgICAgIGlmIChyZXMubWVkaWNhdGlvbkNvZGVhYmxlQ29uY2VwdD8uY29kaW5nKSB7CiAgICAgICAgICAgICAgICBjb2RlcyA9IHJlcy5tZWRpY2F0aW9uQ29kZWFibGVDb25jZXB0LmNvZGluZzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ2FzZSAyOiBtZWRpY2F0aW9uUmVmZXJlbmNlIHRvIE1lZGljYXRpb24gcmVzb3VyY2UKICAgICAgICAgICAgaWYgKHJlcy5tZWRpY2F0aW9uUmVmZXJlbmNlPy5yZWZlcmVuY2UpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG1lZFJlZiA9IHJlcy5tZWRpY2F0aW9uUmVmZXJlbmNlLnJlZmVyZW5jZTsKICAgICAgICAgICAgICAgIGNvbnN0IG1lZCA9IG1lZGljYXRpb25zQnlJZC5nZXQobWVkUmVmKTsKICAgICAgICAgICAgICAgIGlmIChtZWQ/LmNvZGU/LmNvZGluZykgewogICAgICAgICAgICAgICAgICAgIGNvZGVzID0gY29kZXMuY29uY2F0KG1lZC5jb2RlLmNvZGluZyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEV2YWx1YXRlIGFsbCBmb3VuZCBjb2RlcwogICAgICAgICAgICBmb3IgKGNvbnN0IGNvZGluZyBvZiBjb2RlcykgewogICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hCeUNvZGUgPSBjaXRhbG9wcmFtQ29kZXMuaW5jbHVkZXMoY29kaW5nLmNvZGUpOwogICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hCeVRleHQgPSBjaXRhbG9wcmFtS2V5d29yZHMuc29tZSgoa3cpID0+CiAgICAgICAgICAgICAgICAgICAgKGNvZGluZy5kaXNwbGF5IHx8ICIiKS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGt3KQogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBpZiAobWF0Y2hCeUNvZGUgfHwgbWF0Y2hCeVRleHQpIHsKICAgICAgICAgICAgICAgICAgICB0YWtpbmdDaXRhbG9wcmFtID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygi8J+SiiBDaXRhbG9wcmFtIG1hdGNoZWQgdmlhIGNvZGUgb3IgZGlzcGxheToiLCBjb2RpbmcuY29kZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgoKICAgIC8vIGVQSSB0cmFzbGF0aW9uIGZyb20gdGVybWlub2xvZ3kgY29kZXMgdG8gdGhlaXIgaHVtYW4gcmVkYWJsZSB0cmFuc2xhdGlvbnMgaW4gdGhlIHNlY3Rpb25zCiAgICBsZXQgY29tcG9zaXRpb25zID0gMDsKICAgIGxldCBjYXRlZ29yaWVzID0gW107CiAgICBlcGkuZW50cnkuZm9yRWFjaCgoZW50cnkpID0+IHsKICAgICAgICBpZiAoZW50cnkucmVzb3VyY2UucmVzb3VyY2VUeXBlID09ICJDb21wb3NpdGlvbiIpIHsKICAgICAgICAgICAgY29tcG9zaXRpb25zKys7CiAgICAgICAgICAgIC8vSXRlcmF0ZWQgdGhyb3VnaCB0aGUgQ29uZGl0aW9uIGVsZW1lbnQgc2VhcmNoaW5nIGZvciBjb25kaXRpb25zCiAgICAgICAgICAgIGVudHJ5LnJlc291cmNlLmV4dGVuc2lvbi5mb3JFYWNoKChlbGVtZW50KSA9PiB7CgogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIHBvc2l0aW9uIG9mIHRoZSBleHRlbnNpb25bMV0gaXMgY29ycmVjdAogICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuZXh0ZW5zaW9uWzFdLnVybCA9PSAiY29uY2VwdCIpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTZWFyY2ggdGhyb3VnaCB0aGUgZGlmZmVyZW50IHRlcm1pbm9sb2dpZXMgdGhhdCBtYXkgYmUgYXZhaWJsZSB0byBjaGVjayBpbiB0aGUgY29uZGl0aW9uCiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuZXh0ZW5zaW9uWzFdLnZhbHVlQ29kZWFibGVSZWZlcmVuY2UuY29uY2VwdCAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5leHRlbnNpb25bMV0udmFsdWVDb2RlYWJsZVJlZmVyZW5jZS5jb25jZXB0LmNvZGluZy5mb3JFYWNoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvZGluZykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJFeHRlbnNpb246ICIgKyBlbGVtZW50LmV4dGVuc2lvblswXS52YWx1ZVN0cmluZyArICI6IiArIGNvZGluZy5jb2RlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBjb2RlIGlzIGluIHRoZSBsaXN0IG9mIGNhdGVnb3JpZXMgdG8gc2VhcmNoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3RPZkNhdGVnb3JpZXNUb1NlYXJjaC5zb21lKGl0ZW0gPT4gaXRlbS5jb2RlID09PSBjb2RpbmcuY29kZSAmJiBpdGVtLnN5c3RlbSA9PT0gY29kaW5nLnN5c3RlbSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNhdGVnb3J5IGlzIGFscmVhZHkgaW4gdGhlIGxpc3Qgb2YgY2F0ZWdvcmllcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRlZ29yaWVzLnB1c2goZWxlbWVudC5leHRlbnNpb25bMF0udmFsdWVTdHJpbmcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwogICAgaWYgKGNvbXBvc2l0aW9ucyA9PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgZVBJOiBubyBjYXRlZ29yeSAiQ29tcG9zaXRpb24iIGZvdW5kJyk7CiAgICB9CgogICAgaWYgKGNhdGVnb3JpZXMubGVuZ3RoID09IDApIHsKICAgICAgICAvLyB0aHJvdyBuZXcgRXJyb3IoIk5vIGNhdGVnb3JpZXMgZm91bmQiLCBjYXRlZ29yaWVzKTsKICAgICAgICByZXR1cm4gaHRtbERhdGE7CiAgICB9CiAgICBpZiAoaGFzTG93UG90YXNzaXVtICYmIHRha2luZ0NpdGFsb3ByYW0pIHsKICAgICAgICByZXR1cm4gYXdhaXQgYW5ub3RhdGVIVE1Mc2VjdGlvbihjYXRlZ29yaWVzLCBlbmhhbmNlVGFnKTsKICAgIH0KICAgIGVsc2UgewoKICAgICAgICBjb25zb2xlLndhcm4oIk5vIFFUIHByb2xvbmdhdGlvbiByaXNrIGNvbmRpdGlvbiBtZXQuIik7CiAgICAgICAgcmV0dXJuIGh0bWxEYXRhOwogICAgfQoKfTsKCgpmdW5jdGlvbiBnZXRSZXBvcnQobGFuZyA9ICJlbiIpIHsKICAgIGNvbnNvbGUubG9nKCJHZW5lcmF0aW5nIHJlcG9ydCBpbiBsYW5ndWFnZToiLCBsYW5nKTsKICAgIHJldHVybiB7IG1lc3NhZ2U6IGdldEV4cGxhbmF0aW9uKGxhbmcpLCBzdGF0dXM6ICIiIH07CgoKfQoKLy8gLS0tIEdldCB1c2VyLWZhY2luZyByZXBvcnQgc2VudGVuY2UgaW4gdGhlIHNlbGVjdGVkIGxhbmd1YWdlIC0tLQpmdW5jdGlvbiBnZXRFeHBsYW5hdGlvbihsYW5nID0gImVuIikgewogICAgY29uc3QgZXhwbGFuYXRpb25zID0gewogICAgICAgIGVuOiAiVGhpcyBsZW5zIGhpZ2hsaWdodHMgdGhlIHJpc2sgb2YgUVQgcHJvbG9uZ2F0aW9uIGJhc2VkIG9uIG1lZGljYXRpb24gYW5kIGxhYiByZXN1bHRzLiIsCiAgICAgICAgcHQ6ICJFc3RhIGxlbnRlIGRlc3RhY2EgbyByaXNjbyBkZSBwcm9sb25nYW1lbnRvIGRvIGludGVydmFsbyBRVCBjb20gYmFzZSBuYSBtZWRpY2HDp8OjbyBlIG5vcyByZXN1bHRhZG9zIGxhYm9yYXRvcmlhaXMuIiwKICAgICAgICBlczogIkVzdGEgbGVudGUgcmVzYWx0YSBlbCByaWVzZ28gZGUgcHJvbG9uZ2FjacOzbiBkZWwgUVQgYmFzYWRvIGVuIGxhIG1lZGljYWNpw7NuIHkgbG9zIHJlc3VsdGFkb3MgZGUgbGFib3JhdG9yaW8uIiwKICAgICAgICBkYTogIkRlbm5lIGxpbnNlIGZyZW1ow6Z2ZXIgcmlzaWtvZW4gZm9yIFFULWZvcmzDpm5nZWxzZSBiYXNlcmV0IHDDpSBtZWRpY2luIG9nIGxhYm9yYXRvcmllcmVzdWx0YXRlci4iLAogICAgfTsKICAgIHJldHVybiBleHBsYW5hdGlvbnNbbGFuZ10gfHwgZXhwbGFuYXRpb25zLmVuOwp9CgovLyAtLS0gRXhwb3J0ZWQgQVBJIC0tLQpyZXR1cm4gewogICAgZW5oYW5jZTogZW5oYW5jZSwKICAgIGdldFNwZWNpZmljYXRpb246IGdldFNwZWNpZmljYXRpb24sCiAgICBleHBsYW5hdGlvbjogKGxhbmd1YWdlKSA9PiBnZXRFeHBsYW5hdGlvbihsYW5ndWFnZSB8fCBsYW5nIHx8ICJlbiIpLAogICAgcmVwb3J0OiAobGFuZ3VhZ2UpID0+IGdldFJlcG9ydChsYW5ndWFnZSB8fCBsYW5nIHx8ICJlbiIpLAp9Owo=",
      "_title": {
        "extension": [
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "es"
              },
              {
                "url": "content",
                "valueString": "Lente para el riesgo de prolongación del QT"
              }
            ]
          },
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "pt"
              },
              {
                "url": "content",
                "valueString": "Lente para o risco de prolongamento do QT"
              }
            ]
          },
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "da"
              },
              {
                "url": "content",
                "valueString": "Linse til QT-forlængelsesrisiko"
              }
            ]
          }
        ]
      }
    }
  ]
}